{"version":3,"file":"ng-table-virtual-scroll.mjs","sources":["../../../projects/ng-table-virtual-scroll/src/lib/table-data-source.ts","../../../projects/ng-table-virtual-scroll/src/lib/fixed-size-table-virtual-scroll-strategy.ts","../../../projects/ng-table-virtual-scroll/src/lib/table-item-size.directive.ts","../../../projects/ng-table-virtual-scroll/src/lib/table-virtual-scroll.module.ts","../../../projects/ng-table-virtual-scroll/src/public-api.ts","../../../projects/ng-table-virtual-scroll/src/ng-table-virtual-scroll.ts"],"sourcesContent":["import { BehaviorSubject, combineLatest, merge, Observable, of, ReplaySubject, Subject, Subscription } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { MatSort, Sort } from '@angular/material/sort';\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\n\nexport class TableVirtualScrollDataSource<T> extends MatTableDataSource<T> {\n  public dataToRender$: Subject<T[]>;\n  public dataOfRange$: Subject<T[]>;\n  private streamsReady: boolean;\n\n  _updateChangeSubscription() {\n    this.initStreams();\n    const _sort: MatSort | null = this['_sort'];\n    const _paginator: MatPaginator | null = this['_paginator'];\n    const _internalPageChanges: Subject<void> = this['_internalPageChanges'];\n    const _filter: BehaviorSubject<string> = this['_filter'];\n    const _renderData: BehaviorSubject<T[]> = this['_renderData'];\n\n    const sortChange: Observable<Sort | null | void> = _sort ?\n      merge(_sort.sortChange, _sort.initialized) as Observable<Sort | void> :\n      of(null);\n    const pageChange: Observable<PageEvent | null | void> = _paginator ?\n      merge(\n        _paginator.page,\n        _internalPageChanges,\n        _paginator.initialized\n      ) as Observable<PageEvent | void> :\n      of(null);\n    const dataStream: Observable<T[]> = this['_data'];\n    const filteredData = combineLatest([dataStream, _filter])\n      .pipe(map(([data]) => this._filterData(data)));\n    const orderedData = combineLatest([filteredData, sortChange])\n      .pipe(map(([data]) => this._orderData(data)));\n    const paginatedData = combineLatest([orderedData, pageChange])\n      .pipe(map(([data]) => this._pageData(data)));\n\n    this._renderChangesSubscription?.unsubscribe();\n    this._renderChangesSubscription = new Subscription();\n    this._renderChangesSubscription.add(\n      paginatedData.subscribe(data => this.dataToRender$.next(data))\n    );\n    this._renderChangesSubscription.add(\n      this.dataOfRange$.subscribe(data => _renderData.next(data))\n    );\n  }\n\n  private initStreams() {\n    if (!this.streamsReady) {\n      this.dataToRender$ = new ReplaySubject<T[]>(1);\n      this.dataOfRange$ = new ReplaySubject<T[]>(1);\n      this.streamsReady = true;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { CdkVirtualScrollViewport, VirtualScrollStrategy } from '@angular/cdk/scrolling';\nimport { ListRange } from '@angular/cdk/collections';\n\nexport interface TSVStrategyConfigs {\n  rowHeight: number;\n  headerHeight: number;\n  footerHeight: number;\n  bufferMultiplier: number;\n}\n\n@Injectable()\nexport class FixedSizeTableVirtualScrollStrategy implements VirtualScrollStrategy {\n  private rowHeight!: number;\n  private headerHeight!: number;\n  private footerHeight!: number;\n  private bufferMultiplier!: number;\n  private indexChange = new Subject<number>();\n  public stickyChange = new Subject<number>();\n\n  public viewport: CdkVirtualScrollViewport;\n\n  public renderedRangeStream = new BehaviorSubject<ListRange>({start: 0, end: 0});\n\n  public scrolledIndexChange = this.indexChange.pipe(distinctUntilChanged());\n\n  get dataLength(): number {\n    return this._dataLength;\n  }\n\n  set dataLength(value: number) {\n    this._dataLength = value;\n    this.onDataLengthChanged();\n  }\n\n  private _dataLength = 0;\n\n  public attach(viewport: CdkVirtualScrollViewport): void {\n    this.viewport = viewport;\n    this.viewport.renderedRangeStream.subscribe(this.renderedRangeStream);\n    this.onDataLengthChanged();\n  }\n\n  public detach(): void {\n    this.indexChange.complete();\n    this.stickyChange.complete();\n    this.renderedRangeStream.complete();\n  }\n\n  public onContentScrolled(): void {\n    this.updateContent();\n  }\n\n  public onDataLengthChanged(): void {\n    if (this.viewport) {\n      this.viewport.setTotalContentSize(this.dataLength * this.rowHeight + this.headerHeight + this.footerHeight);\n    }\n    this.updateContent();\n  }\n\n  public onContentRendered(): void {\n  }\n\n  public onRenderedOffsetChanged(): void {\n    // no-op\n  }\n\n  public scrollToIndex(index: number, behavior?: ScrollBehavior): void {\n    if (!this.viewport || !this.rowHeight) {\n      return;\n    }\n    this.viewport.scrollToOffset((index - 1 ) * this.rowHeight + this.headerHeight, behavior);\n  }\n\n  public setConfig(configs: TSVStrategyConfigs) {\n    const {rowHeight, headerHeight, footerHeight, bufferMultiplier} = configs;\n    if (\n      this.rowHeight === rowHeight\n      && this.headerHeight === headerHeight\n      && this.footerHeight === footerHeight\n      && this.bufferMultiplier === bufferMultiplier\n    ) {\n      return;\n    }\n    this.rowHeight = rowHeight;\n    this.headerHeight = headerHeight;\n    this.footerHeight = footerHeight;\n    this.bufferMultiplier = bufferMultiplier;\n    this.onDataLengthChanged();\n  }\n\n  private updateContent() {\n    if (!this.viewport || !this.rowHeight) {\n      return;\n    }\n\n    const renderedOffset = this.viewport.getOffsetToRenderedContentStart();\n    const start = renderedOffset / this.rowHeight;\n    const itemsDisplayed = Math.ceil(this.viewport.getViewportSize() / this.rowHeight);\n    const bufferItems = Math.ceil(itemsDisplayed * this.bufferMultiplier);\n    const end = start + itemsDisplayed + 2 * bufferItems;\n\n\n    const bufferOffset = renderedOffset + bufferItems * this.rowHeight;\n    const scrollOffset = this.viewport.measureScrollOffset();\n\n    // How far the scroll offset is from the lower buffer, which is usually where items start being displayed\n    const relativeScrollOffset = scrollOffset - bufferOffset;\n    const rowsScrolled = relativeScrollOffset / this.rowHeight;\n\n    const displayed = scrollOffset / this.rowHeight;\n    this.indexChange.next(displayed);\n\n    // Only bother updating the displayed information if we've scrolled more than a row\n    const rowSensitivity = 1.0;\n    if (Math.abs(rowsScrolled) < rowSensitivity) {\n      this.viewport.setRenderedContentOffset(renderedOffset);\n      this.viewport.setRenderedRange({start, end});\n      return;\n    }\n\n    // Special case for the start of the table.\n    // At the top of the table, the first few rows are first rendered because they're visible, and then still rendered\n    // Because they move into the buffer. So we only need to change what's rendered once the user scrolls far enough down.\n    if (renderedOffset === 0 && rowsScrolled < 0) {\n      this.viewport.setRenderedContentOffset(renderedOffset);\n      this.viewport.setRenderedRange({start, end});\n      return;\n    }\n\n    const rowsToMove = Math.sign(rowsScrolled) * Math.floor(Math.abs(rowsScrolled));\n    const adjustedRenderedOffset = Math.max(0, renderedOffset + rowsToMove * this.rowHeight);\n    this.viewport.setRenderedContentOffset(adjustedRenderedOffset);\n\n    const adjustedStart = Math.max(0, start + rowsToMove);\n    const adjustedEnd = adjustedStart + itemsDisplayed + 2 * bufferItems;\n    this.viewport.setRenderedRange({start: adjustedStart, end: adjustedEnd});\n\n    this.stickyChange.next(adjustedRenderedOffset);\n  }\n}\n","import {\n  AfterContentInit,\n  ContentChild,\n  Directive,\n  forwardRef,\n  Input,\n  NgZone,\n  OnChanges,\n  OnDestroy\n} from '@angular/core';\nimport { VIRTUAL_SCROLL_STRATEGY } from '@angular/cdk/scrolling';\nimport {\n  delayWhen,\n  distinctUntilChanged,\n  filter,\n  map,\n  startWith,\n  switchMap,\n  take,\n  takeUntil,\n  tap\n} from 'rxjs/operators';\nimport { TableVirtualScrollDataSource } from './table-data-source';\nimport { MatTable } from '@angular/material/table';\nimport { FixedSizeTableVirtualScrollStrategy } from './fixed-size-table-virtual-scroll-strategy';\nimport { CdkHeaderRowDef } from '@angular/cdk/table';\nimport { combineLatest, from, Subject } from 'rxjs';\n\nexport function _tableVirtualScrollDirectiveStrategyFactory(tableDir: TableItemSizeDirective) {\n  return tableDir.scrollStrategy;\n}\n\nconst stickyHeaderSelector = '.mat-header-row .mat-table-sticky, .mat-header-row.mat-table-sticky';\nconst stickyFooterSelector = '.mat-footer-row .mat-table-sticky, .mat-header-row.mat-table-sticky';\n\nconst defaults = {\n  rowHeight: 48,\n  headerHeight: 56,\n  headerEnabled: true,\n  footerHeight: 48,\n  footerEnabled: false,\n  bufferMultiplier: 0.7\n};\n\n@Directive({\n  selector: 'cdk-virtual-scroll-viewport[tvsItemSize]',\n  providers: [{\n    provide: VIRTUAL_SCROLL_STRATEGY,\n    useFactory: _tableVirtualScrollDirectiveStrategyFactory,\n    deps: [forwardRef(() => TableItemSizeDirective)]\n  }]\n})\nexport class TableItemSizeDirective implements OnChanges, AfterContentInit, OnDestroy {\n  private destroyed$ = new Subject<void>();\n\n  // tslint:disable-next-line:no-input-rename\n  @Input('tvsItemSize')\n  rowHeight: string | number = defaults.rowHeight;\n\n  @Input()\n  headerEnabled: boolean = defaults.headerEnabled;\n\n  @Input()\n  headerHeight: string | number = defaults.headerHeight;\n\n  @Input()\n  footerEnabled: boolean = defaults.footerEnabled;\n\n  @Input()\n  footerHeight: string | number = defaults.footerHeight;\n\n  @Input()\n  bufferMultiplier: string | number = defaults.bufferMultiplier;\n\n  @ContentChild(MatTable, { static: false })\n  table: MatTable<any>;\n\n  scrollStrategy = new FixedSizeTableVirtualScrollStrategy();\n\n  dataSourceChanges = new Subject<void>();\n\n  private stickyPositions: Map<HTMLElement, number>;\n  private resetStickyPositions = new Subject<void>();\n\n  constructor(private zone: NgZone) {\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next();\n    this.destroyed$.complete();\n    this.dataSourceChanges.complete();\n  }\n\n  private isStickyEnabled(): boolean {\n    return !!this.scrollStrategy.viewport && (this.table['_headerRowDefs'] as CdkHeaderRowDef[])\n      .map(def => def.sticky)\n      .reduce((prevState, state) => prevState && state, true);\n  }\n\n  ngAfterContentInit() {\n    const switchDataSourceOrigin = this.table['_switchDataSource'];\n    this.table['_switchDataSource'] = (dataSource: any) => {\n      switchDataSourceOrigin.call(this.table, dataSource);\n      this.connectDataSource(dataSource);\n    };\n\n    const updateStickyColumnStylesOrigin = this.table.updateStickyColumnStyles;\n    this.table.updateStickyColumnStyles = () => {\n      const stickyColumnStylesNeedReset = this.table['_stickyColumnStylesNeedReset'];\n      updateStickyColumnStylesOrigin.call(this.table);\n      if (stickyColumnStylesNeedReset) {\n        this.resetStickyPositions.next();\n      }\n    };\n\n    this.connectDataSource(this.table.dataSource);\n\n    combineLatest([\n      this.scrollStrategy.stickyChange,\n      this.resetStickyPositions.pipe(\n        startWith(void 0),\n        delayWhen(() => this.getScheduleObservable()),\n        tap(() => {\n          this.stickyPositions = null;\n        })\n      )\n    ])\n      .pipe(\n        filter(() => this.isStickyEnabled()),\n        takeUntil(this.destroyed$)\n      )\n      .subscribe(([stickyOffset]) => {\n        if (!this.stickyPositions) {\n          this.initStickyPositions();\n        }\n        this.setSticky(stickyOffset);\n      });\n  }\n\n  connectDataSource(dataSource: any) {\n    this.dataSourceChanges.next();\n    if (dataSource instanceof TableVirtualScrollDataSource) {\n      dataSource\n        .dataToRender$\n        .pipe(\n          distinctUntilChanged(),\n          takeUntil(this.dataSourceChanges),\n          takeUntil(this.destroyed$),\n          tap(data => this.scrollStrategy.dataLength = data.length),\n          switchMap(data =>\n            this.scrollStrategy\n              .renderedRangeStream\n              .pipe(\n                map(({\n                       start,\n                       end\n                     }) => typeof start !== 'number' || typeof end !== 'number' ? data : data.slice(start, end))\n              )\n          )\n        )\n        .subscribe(data => {\n          this.zone.run(() => {\n            dataSource.dataOfRange$.next(data);\n          });\n        });\n    } else {\n      throw new Error('[tvsItemSize] requires TableVirtualScrollDataSource be set as [dataSource] of [mat-table]');\n    }\n  }\n\n  ngOnChanges() {\n    const config = {\n      rowHeight: +this.rowHeight || defaults.rowHeight,\n      headerHeight: this.headerEnabled ? +this.headerHeight || defaults.headerHeight : 0,\n      footerHeight: this.footerEnabled ? +this.footerHeight || defaults.footerHeight : 0,\n      bufferMultiplier: +this.bufferMultiplier || defaults.bufferMultiplier\n    };\n    this.scrollStrategy.setConfig(config);\n  }\n\n\n  setSticky(offset: number) {\n    this.scrollStrategy.viewport.elementRef.nativeElement.querySelectorAll(stickyHeaderSelector)\n      .forEach((el: HTMLElement) => {\n        const parent = el.parentElement;\n        let baseOffset = 0;\n        if (this.stickyPositions.has(parent)) {\n          baseOffset = this.stickyPositions.get(parent);\n        }\n        el.style.top = `${baseOffset - offset}px`;\n      });\n    this.scrollStrategy.viewport.elementRef.nativeElement.querySelectorAll(stickyFooterSelector)\n      .forEach((el: HTMLElement) => {\n        const parent = el.parentElement;\n        let baseOffset = 0;\n        if (this.stickyPositions.has(parent)) {\n          baseOffset = this.stickyPositions.get(parent);\n        }\n        el.style.bottom = `${-baseOffset + offset}px`;\n      });\n  }\n\n  private initStickyPositions() {\n    this.stickyPositions = new Map<HTMLElement, number>();\n    this.scrollStrategy.viewport.elementRef.nativeElement.querySelectorAll(stickyHeaderSelector)\n      .forEach(el => {\n        const parent = el.parentElement;\n        if (!this.stickyPositions.has(parent)) {\n          this.stickyPositions.set(parent, parent.offsetTop);\n        }\n      });\n    this.scrollStrategy.viewport.elementRef.nativeElement.querySelectorAll(stickyFooterSelector)\n      .forEach(el => {\n        const parent = el.parentElement;\n        if (!this.stickyPositions.has(parent)) {\n          this.stickyPositions.set(parent, -parent.offsetTop);\n        }\n      });\n  }\n\n\n  private getScheduleObservable() {\n    // Use onStable when in the context of an ongoing change detection cycle so that we\n    // do not accidentally trigger additional cycles.\n    return this.zone.isStable\n      ? from(Promise.resolve(undefined))\n      : this.zone.onStable.pipe(take(1));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { TableItemSizeDirective } from './table-item-size.directive';\n\n\n@NgModule({\n  declarations: [TableItemSizeDirective],\n  imports: [],\n  exports: [TableItemSizeDirective]\n})\nexport class TableVirtualScrollModule {\n}\n","/*\n * Public API Surface of ng-fixed-size-table-virtual-scroll\n */\n\nexport * from './lib/table-virtual-scroll.module';\nexport * from './lib/table-item-size.directive';\nexport * from './lib/fixed-size-table-virtual-scroll-strategy';\nexport * from './lib/table-data-source';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}